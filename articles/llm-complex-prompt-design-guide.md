---
title: "LLMと育てる複雑プロンプト設計ガイド"
emoji: "🧠"
type: "tech"
topics: ["prompt-engineering","llm","workflow"]
published: false
---

# はじめに

大規模言語モデル（LLM）と協働して複雑なプロンプトファイルを設計・改善する際は、手順を体系化しないと出力の再現性やメンテナンス性が低下します。本記事では、`enum-replace-refactoring.md` のようなプロンプトを育て上げるためのワークフローを解説します。ベースとなる考え方は、Zenn記事「実務で使える汎用プロンプトテンプレートの設計思想と使い方」で整理されている汎用テンプレート構造です。[出典](https://zenn.dev/emrum/articles/prompt-template-design-best-practices)

## 全体フロー

以下のフローチャートはプロンプト作成から反復改善までのループを示します。

```maid
flowchart TD
    A[テンプレートを理解<br>（セクションの意図確認）] --> B[LLMへ指示セットを渡して初期プロンプト生成]
    B --> C[条件分岐を手順に反映<br>判断基準を明文化]
    C --> D[内容の肥大化を検知<br>分割方針を提示]
    D --> E[各ファイルを約200行になるまで圧縮・再構成]
    E --> F[プロンプトを実行し挙動を確認]
    F --> G[PR等のフィードバックをLLMへ入力]
    G --> F```

## ステップ1: テンプレートをLLMに共有して初期プロンプトを生成する

- 目的: 汎用テンプレートのセクション構造（Front Matter、役割、実行手順、エラー対処、出力ルール、開始メッセージ）を保持したまま、対象タスク専用の骨子を作成する。
- 実行: LLMに対し、プロンプトの目的・制約・成果物フォーマットとともに、参考とするテンプレート記事の要点や引用箇所を渡します。[出典](https://zenn.dev/emrum/articles/prompt-template-design-best-practices)

## ステップ2: 条件分岐は実行手順に落とし込み、判断基準を明文化する

- 条件が増えるほど曖昧な記述になりやすいので、手順内に「もし◯◯なら△△を行う」と具体的に書く。
- `enum-replace-refactoring.md` のように、参照元ファイルや利用ツールの制約を個別に明示することで、実行者（または次に参照するLLM）の迷いを防ぎます。

## ステップ3: ファイルの肥大化を検知したらLLMに分割戦略を提案させる

- 初期版は1ファイルで書き上げ、想定より大きくなった段階で「どのセクションを別ファイルにすると理解しやすいか」をLLMに考えさせる。
- 例: ワークフロー本体、パターン別詳細、リファレンス、トラブルシュートなどに分離。

## ステップ4: 各ファイルが200行前後になるよう反復最適化する

- 分割後も定期的に行数を確認し、LLMに「200行目標で再構成して」と指示する。
- 冗長な表現の圧縮、共通セクションのモジュール化、重複表現の削除などを繰り返す。
- 人間のレビュアーにとってもスクロール負荷が少ない分量に収めることで、レビューサイクル全体のスピードと理解度が向上する。

## ステップ5: 実際にプロンプトを実行し、期待通りの成果物が得られるか検証する

- プロンプトドリブンな実装やドキュメント生成など、目的となるタスクを試す。
- 期待外の挙動があれば「想定入力」「得られた出力」「理想の出力」をLLMにフィードバックとして渡す。

## ステップ6: PRやレビューコメントなどのフィードバックをLLMに反映させる

- Pull Requestやレビューコメントをプロンプト改善の根拠として提示し、修正案を作らせる。
- 記録された課題・改善案を新しいセクションやFAQとして追記し、ドキュメント性を高める。

## ステップ7: ステップ5・6を満足いくまでループし、完成度を高める

- プロダクト要件が変われば再ループする前提で「再現性のある変更履歴」を残す。
- ループ終了の判断基準（例: 指定タスクで成功率が一定値を超えたら完了）を明文化すると、今後の改善にも活かせます。

## 実務でのポイント

- **判断基準の可視化**: 「どの条件でどのファイルを参照するか」を必ず文章で説明する。
- **ツール制約の明記**: allowed-toolsや使用禁止事項をFront Matterで固定し、誤操作を防ぐ。
- **テンプレートとの整合**: テンプレート記事で解説されている役割やエラー対処は、新しいプロンプトでも必ず埋める。[出典](https://zenn.dev/emrum/articles/prompt-template-design-best-practices)
- **反復記録**: 改善履歴や失敗例を残し、次に参照する人・LLMが同じ壁にぶつからないようにする。

## 参考情報

Fact
> LLM向けプロンプトテンプレートの標準構成（Front Matter、役割、実行手順、エラー対処、出力ルール、開始メッセージ）は、Zenn記事「実務で使える汎用プロンプトテンプレートの設計思想と使い方」で解説されている。
> 出典: https://zenn.dev/emrum/articles/prompt-template-design-best-practices
> 確信度: High

Hypothesis
> 200行前後に収めることで人間のレビュアーが主要ポイントを一読で把握でき、レビュー効率が向上する。
> 根拠: テクニカルライティングの一般的な経験則として、長大な文書はスクロール量と情報過多により理解コストが増大する。
> 確信度: Medium
